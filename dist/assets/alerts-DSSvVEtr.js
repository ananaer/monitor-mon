import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css               */import{e as l,f as g}from"./format-DR5tjaKg.js";const f=50,e={refreshBtn:document.getElementById("refresh-btn"),refreshStatus:document.getElementById("refresh-status"),statsRow:document.getElementById("stats-row"),filterBar:document.getElementById("filter-bar"),statTotal:document.getElementById("stat-total"),statCritical:document.getElementById("stat-critical"),statWarn:document.getElementById("stat-warn"),statVenues:document.getElementById("stat-venues"),severityPills:document.getElementById("severity-pills"),venueSelect:document.getElementById("venue-select"),resultCount:document.getElementById("result-count"),emptyState:document.getElementById("empty-state"),errorState:document.getElementById("error-state"),alertList:document.getElementById("alert-list"),loadMoreWrap:document.getElementById("load-more-wrap"),loadMoreBtn:document.getElementById("load-more-btn")};let r=[],i=[],o=0,d="all",u="all",v=!1;function c(t,s){e.refreshStatus.textContent=t,e.refreshStatus.className=`refresh-status ${s}`}function p(t){v=t,e.refreshBtn.disabled=t,e.refreshBtn.textContent=t?"加载中...":"刷新"}function I(t){return{depth_shrink:"深度萎缩",spread_widen:"价差扩大"}[t]||t}function S(t){if(t.threshold_val==null&&t.current_val==null)return"";const s=[];return t.current_val!=null&&s.push(`当前值: ${Number(t.current_val).toPrecision(4)}`),t.threshold_val!=null&&s.push(`阈值: ${Number(t.threshold_val).toPrecision(4)}`),s.join(" · ")}function h(){const t=i.slice(0,o);if(i.length===0){e.emptyState.classList.remove("hidden"),e.resultCount.classList.add("hidden"),e.alertList.innerHTML="",e.loadMoreWrap.style.display="none";return}e.emptyState.classList.add("hidden"),e.resultCount.classList.remove("hidden"),e.resultCount.textContent=`显示 ${t.length} / ${i.length} 条`,e.alertList.innerHTML=t.map(s=>{const n=S(s);return`
    <li class="alert-item-full">
      <div class="alert-left">
        <span class="severity-tag sev-${l(s.severity||"info")}">${l((s.severity||"info").toUpperCase())}</span>
      </div>
      <div class="alert-center">
        <p class="alert-type-name">${l(I(s.alert_type||"-"))}</p>
        <p class="alert-message">${l(s.message||"-")}</p>
        <div class="alert-meta-row">
          <span class="alert-venue-badge">${l((s.venue||"-").toUpperCase())}</span>
          ${n?`<span class="tiny">${l(n)}</span>`:""}
        </div>
      </div>
      <div class="alert-right">
        <p class="alert-time">${l(g(s.ts_utc))}</p>
      </div>
    </li>`}).join(""),e.loadMoreWrap.style.display=o<i.length?"block":"none",e.loadMoreBtn.disabled=!1}function m(){i=r.filter(t=>!(d!=="all"&&t.severity!==d||u!=="all"&&t.venue!==u)),o=f,h()}function B(){const t=r.filter(a=>a.severity==="critical").length,s=r.filter(a=>a.severity==="warn").length,n=new Set(r.map(a=>a.venue)).size;e.statTotal.textContent=String(r.length),e.statCritical.textContent=String(t),e.statWarn.textContent=String(s),e.statVenues.textContent=String(n),e.statsRow.style.display="flex"}function E(){const t=[...new Set(r.map(n=>n.venue).filter(Boolean))].sort(),s=e.venueSelect.value;e.venueSelect.innerHTML='<option value="all">全部</option>'+t.map(n=>`<option value="${l(n)}">${l(n.toUpperCase())}</option>`).join(""),t.includes(s)&&(e.venueSelect.value=s)}async function y(){if(!v){p(!0),c("加载中...","status-loading"),e.errorState.classList.add("hidden");try{const s=await fetch("https://joisixcdkdihqduxllzn.supabase.co/functions/v1/api-alerts?limit=200",{headers:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpvaXNpeGNka2RpaHFkdXhsbHpuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE0ODM2NjYsImV4cCI6MjA4NzA1OTY2Nn0.3v-G_lTJOnex0am3BLMgGA97_ZZ3tg9j8tXdDsN2H-U","Content-Type":"application/json"},cache:"no-store"});if(!s.ok)throw new Error(`请求失败 ${s.status}`);r=(await s.json()).items||[],B(),E(),e.filterBar.style.display="flex",m();const a=new Date().toLocaleTimeString("zh-CN",{hour12:!1});c(`已更新 ${a}`,"status-success")}catch(t){e.errorState.textContent=`加载失败: ${t.message}`,e.errorState.classList.remove("hidden"),c("加载失败","status-error")}finally{p(!1)}}}function C(){e.refreshBtn.addEventListener("click",y),e.severityPills.addEventListener("click",t=>{const s=t.target.closest(".filter-pill");s&&(d=s.dataset.sev,e.severityPills.querySelectorAll(".filter-pill").forEach(n=>n.classList.remove("active")),s.classList.add("active"),m())}),e.venueSelect.addEventListener("change",()=>{u=e.venueSelect.value,m()}),e.loadMoreBtn.addEventListener("click",()=>{o+=f,h()})}C();y();
